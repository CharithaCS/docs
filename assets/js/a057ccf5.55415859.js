"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[762],{3430:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>c,default:()=>g,frontMatter:()=>r,metadata:()=>d,toc:()=>p});var a=n(7462),l=(n(7294),n(3905)),i=n(3901),s=n(5488),o=n(5162);const r={sidebar_position:4},c="Deploy mTLS",d={unversionedId:"documentation/getting-started/mtls",id:"documentation/getting-started/mtls",title:"Deploy mTLS",description:"Get started with Otterize.",source:"@site/docs/documentation/getting-started/mtls.md",sourceDirName:"documentation/getting-started",slug:"/documentation/getting-started/mtls",permalink:"/documentation/getting-started/mtls",draft:!1,editUrl:"https://github.com/otterize/docs/edit/main/docs/documentation/getting-started/mtls.md",tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"docSidebar",previous:{title:"Getting started with Network Policies",permalink:"/documentation/getting-started/network-policies"},next:{title:"index",permalink:"/documentation/guides/"}},m={},p=[{value:"Install Otterize (enable mTLS)",id:"install-otterize-enable-mtls",level:2},{value:"Pick a scope",id:"pick-a-scope",level:2},{value:"Annotate deployments",id:"annotate-deployments",level:2},{value:"Apply deployment",id:"apply-deployment",level:2},{value:"What&#39;s next",id:"whats-next",level:2},{value:"Testing - optional",id:"testing---optional",level:2},{value:"Inspect the certificate",id:"inspect-the-certificate",level:3},{value:"Test mTLS",id:"test-mtls",level:3},{value:"Test unsecured access",id:"test-unsecured-access",level:3}],u={toc:p};function g(e){let{components:t,...n}=e;return(0,l.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h1",{id:"deploy-mtls"},"Deploy mTLS"),(0,l.kt)("p",null,"Get started with Otterize."),(0,l.kt)(i.Z,{toc:p,mdxType:"TOCInline"}),(0,l.kt)("h2",{id:"install-otterize-enable-mtls"},"Install Otterize (enable mTLS)"),(0,l.kt)("p",null,"Module"),(0,l.kt)("h2",{id:"pick-a-scope"},"Pick a scope"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Choose existing deployments"),(0,l.kt)("li",{parentName:"ol"},"Deploy and use demo client/server provided here (link to github)")),(0,l.kt)("h2",{id:"annotate-deployments"},"Annotate deployments"),(0,l.kt)("p",null,"To generate credentials for a pod we need to"),(0,l.kt)("ol",null,(0,l.kt)("li",{parentName:"ol"},"Annotate the pod to trigger credential generation.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"annotations:\n  otterize/credentials-secret-name: client-credentials-secret\n")),(0,l.kt)("ol",{start:2},(0,l.kt)("li",{parentName:"ol"},"Mount credentials to pod.")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml"},"spec:\n  containers:\n    - name: client\n      ...\n      volumeMounts:\n        - name: otterize-tls\n          mountPath: /etc/otterize\n          readOnly: true\n  volumes:\n    - name: otterize-tls\n      secret:\n        secretName: client-credentials-secret\n")),(0,l.kt)("details",null,(0,l.kt)("summary",null,"Complete YAML"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-yaml",metastring:'title="code-examples/getting-started/deploy-mtls/client.yaml"',title:'"code-examples/getting-started/deploy-mtls/client.yaml"'},'apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: client\nspec:\n  selector:\n    matchLabels:\n      app: client\n  template:\n    metadata:\n      labels:\n        app: client\n      annotations:\n        otterize/credentials-secret-name: client-credentials-secret\n    spec:\n      containers:\n        - name: client\n          image: alpine/openssl\n          command: [ "/bin/sh", "-c", "--" ]\n          args: [ "trap : TERM INT; sleep infinity & wait" ]\n          volumeMounts:\n            - name: otterize-credentials\n              mountPath: /etc/otterize\n              readOnly: true\n      volumes:\n        - name: otterize-credentials\n          secret:\n            secretName: client-credentials-secret\n'))),(0,l.kt)("admonition",{type:"tip"},(0,l.kt)("p",{parentName:"admonition"},"Visit the ",(0,l.kt)("a",{parentName:"p",href:"/documentation/credential-operator/behavior"},"Behavior")," section to view all parameters available as pod annotation for generating mTLS credentials.")),(0,l.kt)("h2",{id:"apply-deployment"},"Apply deployment"),(0,l.kt)(s.Z,{mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"local",label:"Local",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f client.yaml\n"))),(0,l.kt)(o.Z,{value:"github",label:"GitHub",mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl apply -f https://github.com/otterize/docs/blob/main/code-examples/getting-started/deploy-mtls/client.yaml\n")))),(0,l.kt)("h2",{id:"whats-next"},"What's next"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"Read about how to integrate mTLS into common SDKs and frameworks"),(0,l.kt)("li",{parentName:"ul"},"Enforce secure Kafka access")),(0,l.kt)("h2",{id:"testing---optional"},"Testing - optional"),(0,l.kt)("p",null,"Following are examples for how you can test the generated credentials"),(0,l.kt)("h3",{id:"inspect-the-certificate"},"Inspect the certificate"),(0,l.kt)(s.Z,{mdxType:"Tabs"},(0,l.kt)(o.Z,{value:"secret-direct",label:"K8s secret",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl get secret client-credentials-secret -o jsonpath='{.data.svid\\.pem}' | base64 -d > svid.pem\nopenssl x509 -in /etc/otterize/svid.pem -text | head -n 15\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-x509",metastring:'title="Result"',title:'"Result"'},"Certificate:\n    Data:\n        Version: 3 (0x2)\n        Serial Number:\n            66:3d:ea:77:70:85:84:64:da:cd:50:6d:43:32:ab:2e\n        Signature Algorithm: sha256WithRSAEncryption\n        Issuer: C = US, O = SPIFFE\n        Validity\n            Not Before: Aug 17 08:36:18 2022 GMT\n            Not After : Aug 17 09:36:28 2022 GMT\n        Subject: C = US, O = SPIRE, CN = tomer-client.tomer-test\n        Subject Public Key Info:\n            Public Key Algorithm: id-ecPublicKey\n                Public-Key: (256 bit)\n                pub:\n"))),(0,l.kt)(o.Z,{value:"secret-pod",label:"K8s pod mount",default:!0,mdxType:"TabItem"},(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"kubectl exec -it deploy/client -- sh\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-shell"},"openssl x509 -in svid.pem -text | head -n 15\n")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-x509",metastring:'title="Result"',title:'"Result"'},"Certificate:\n    Data:\n        Version: 3 (0x2)\n        Serial Number:\n            66:3d:ea:77:70:85:84:64:da:cd:50:6d:43:32:ab:2e\n        Signature Algorithm: sha256WithRSAEncryption\n        Issuer: C = US, O = SPIFFE\n        Validity\n            Not Before: Aug 17 08:36:18 2022 GMT\n            Not After : Aug 17 09:36:28 2022 GMT\n        Subject: C = US, O = SPIRE, CN = tomer-client.tomer-test\n        Subject Public Key Info:\n            Public Key Algorithm: id-ecPublicKey\n                Public-Key: (256 bit)\n                pub:\n")))),(0,l.kt)("h3",{id:"test-mtls"},"Test mTLS"),(0,l.kt)("h3",{id:"test-unsecured-access"},"Test unsecured access"))}g.isMDXComponent=!0}}]);
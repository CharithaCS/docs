---
sidebar_position: 2
title: Kafka watcher
---

The Kafka watcher periodically examines logs of Kafka brokers provided by the user through configuration,
parses them and deduces topic-level access to Kafka from pods in the Kubernetes cluster.

## Enabling debug logs for the Bitnami Kafka chart
In order for the Kafka watcher to be able to examine topic-level access, the Kafka server's ACL authorizer logger must be configured.

We do this by setting the logger for `kafka.authorizer` to DEBUG level.


The deployment examples below include examples on how to configure the Kafka logger and Kafka watcher to work together.
The examples are given in the form of a `values.yaml` for the [Bitnami Kafka](https://artifacthub.io/packages/helm/bitnami/kafka) chart, and work with our tutorials.

## Deployment
The Kafka watcher can be deployed in a Kubernetes environment in two modes. As a sidecar, and as an independent pod that tails Kafka broker logs using the Kubernetes API.

### Deploy a sidecar container in the Kafka pod
In this mode, Kafka is configured to generate logs from authorization decisions and write them to a volume shared with the Kafka watcher container, which is deployed as a sidecar in the same pod.

The Kafka watcher collects these logs and sends them to the network mapper.

#### Configure the Bitnami Kafka chart to output logs to file and the Kafka watcher as a sidecar container
<details>
    <summary>Expand to see the Helm values.yaml used with the Bitnami chart</summary>

```yaml
{@include: ../../../../static/code-examples/kafka-mtls/helm/values_debug_logging_k8s_watcher.yaml}
```
</details>


### Deploy as part of the Otterize deployment, tailing Kafka logs
In this mode, an additional `kafka-watcher` pod is deployed alongside the Otterize network mapper, which uses the Kubernetes API to tail logs outputted to stdout by Kafka brokers in the cluster.
To configure the Kafka brokers, use the `kafkawatcher.kafkaServers` value in the Helm chart.

To deploy the network mapper with the Kafka watcher component:
```bash
helm repo add otterize https://helm.otterize.com
helm repo update
helm install network-mapper otterize/network-mapper -n otterize-system --create-namespace --set kafkawatcher.enableK8sWatchModeK8sWatchMode=true
```
Make sure to include `--set kafkawatcher.kafkaServers=<server list>` and provide a list of Kafka servers whose logs the Kafka watcher should watch.
Servers in the list should be specified as `name.namespace`. For example, `--set kafkawatcher.kafkaServers=["kafka-0.kafka"]`


#### Configure the Bitnami Kafka chart to output logs to stdout for the Kafka watcher to read them
<details>
<summary>Expand to see the Helm values.yaml used with the Bitnami chart</summary>

```yaml
{@include: ../../../../static/code-examples/kafka-mtls/helm/values_debug_logging_k8s_watcher.yaml}
```
</details>


## Kafka watcher parameters
| Key                                           | Description                                                                                                  | Default                        |
|-----------------------------------------------|--------------------------------------------------------------------------------------------------------------|--------------------------------|
| `kafkawatcher.enableK8sWatchModeK8sWatchMode` | Enable Kafka watcher deployment, which reads Kafka logs using the Kubernetes API, for pods in `kafkaServers` | `false`                        |
| `kafkawatcher.kafkaServers`                   | Kafka servers to watch, formatted as a list of `pod.namespace`. For example, `["kafka-0.kafka"]`             | `(none)`                       |
| `kafkawatcher.image.repository`               | Kafka watcher image repository.                                                                              | `otterize`                     |
| `kafkawatcher.image.image`                    | Kafka watcher image.                                                                                         | `network-mapper-kafka-watcher` |
| `kafkawatcher.image.tag`                      | Kafka watcher image tag.                                                                                     | `latest`                       |
| `kafkawatcher.pullPolicy`                     | Kafka watcher pull policy.                                                                                   | `(none)`                       |
| `kafkawatcher.pullSecrets`                    | Kafka watcher pull secrets.                                                                                  | `(none)`                       |
| `kafkawatcher.resources`                      | Resources override.                                                                                          | `(none)`                       |

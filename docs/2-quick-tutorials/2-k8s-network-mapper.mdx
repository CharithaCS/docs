---
sidebar_position: 2
title: Map your cluster
---
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

The network mapper allows you to map pod-to-pod traffic within your K8s cluster. This tutorial will guide you
through installing Otterize, mapping traffic and tracking changes.

## Install the network mapper

{@include: ../_common/install-otterize-network-mapper.md}

## Install the Otterize CLI

{@include: ../_common/install-otterize-cli.md}

## Map the cluster

The network mapper starts to sniff traffic and build an in-memory network map as soon as it's installed.

### Deploy demo to simulate traffic
Add traffic to the cluster and see how the network mapper tracks it. You can do that by deploying our
example which consists of three pods: client, client2 and server, communicating over HTTP. Deploy example:
```shell
kubectl apply -n otterize-tutorial-mapper -f https://docs.otterize.com/code-examples/network-mapper/all.yaml
```

### Show mapped traffic

{@include: ../_common/network-mapper/intents-list-export.md}

:::info
See the [CLI documentation](/cli) for more details about the CLI.
:::

### Change traffic -> Sniff&Diff

One of the benefits for using the network mapper is the ability to track changes over time for communication within your
cluster.

1. Let's save the current state of traffic from the cluster into a file we will compare against later:
   ```shell
   otterize mapper list -n otterize-tutorial-mapper > intents-original.txt
   ```

2. And now we can add more traffic to the cluster and see how the network mapper tracks it. You can do that by deploying the extension
   example which consists of two pods: other-client and other-server, communicating over HTTP. Deploy example:
   ```shell
   kubectl apply -n otterize-tutorial-mapper -f https://docs.otterize.com/code-examples/network-mapper/all-other.yaml
   ```

<details>
<summary>Check that the client and server pods were deployed</summary>

```bash
kubectl get pods -n otterize-tutorial-mapper
```
You should see
```
NAME                      READY   STATUS    RESTARTS   AGE
client-756f7677f8-rdm8l         1/1     Running   0          15m
client2-5c4479947b-cdkl2        1/1     Running   0          9m18s
other-client-8666d97d9c-29xpg   1/1     Running   0          4m8s
other-server-676dbc5f5-bqxs4    1/1     Running   0          4m3s
server-6698c58cbc-tht9n         1/1     Running   0          15m
```
</details>

3. Export the updated observed intents:
   ```shell
   otterize mapper list -n otterize-tutorial-mapper
   ```
   You will now see the client and server pods communication in addition
   to the previously observed traffic.
   ```shell
   client in namespace otterize-tutorial-mapper calls:
     - server
   client2 in namespace otterize-tutorial-mapper calls:
     - server
   # highlight-start
   other-client in namespace otterize-tutorial-mapper calls:
     - other-server
   # highlight-end
      ```
5. We can also compare both outputs to see the difference. We'll start by saving the updated state to a file with:
   ```bash
   otterize mapper list -n otterize-tutorial-mapper > intents-updated.txt
   ```
6. And compare the original file with the updated file using:
   ```bash
   diff --color=always -y intents-original.txt intents-updated.txt;echo
   ```
   You should see a result looking like:
   ```bash
   client in namespace otterize-tutorial-mapper calls:             client in namespace otterize-tutorial-mapper calls:
     - server                                                        - server
   client2 in namespace otterize-tutorial-mapper calls:            client2 in namespace otterize-tutorial-mapper calls:
     - server                                                        - server
   # highlight-start
                                                                  > other-client in namespace otterize-tutorial-mapper calls:
                                                                  >   - other-server
   # highlight-end
      ```

## What's next

Now that we've observed cluster intents we can enforce them with the intents operator.

- Configure [network policies](/quick-tutorials/k8s-network-policies).
- Configure [secure access for Kafka](/quick-tutorials/kafka-mtls).

### Teardown

To remove the deployed resources run:

```bash
kubectl delete namespace otterize-tutorial-mapper
helm network-mapper uninstall -n otterize-system
```
